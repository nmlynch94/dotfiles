function tp() {
  #!/usr/bin/env bash

  PROJECT_ROOT="$PROJECT_ROOT:-$HOME/projects"

  PROJECT_ROOT="$HOME/projects"

  PROJECT_DIR=$(find "$PROJECT_ROOT" -mindepth 1 -maxdepth 1 -type d | fzf --prompt="Select project: ")
  [ -z "$PROJECT_DIR" ] && exit 0

  SESSION_NAME=$(basename "$PROJECT_DIR")

  # If session already exists, attach to it
  if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    exec tmux attach-session -t "$SESSION_NAME"
  fi

  # Create the session with a shell window first (so nvim ends up at index 1)
  tmux new-session -s "$SESSION_NAME" -c "$PROJECT_DIR" -n shell -d
  tmux new-window -t "$SESSION_NAME" -n nvim -c "$PROJECT_DIR" "nvim"

  # Switch to nvim window before attaching
  tmux select-window -t "$SESSION_NAME:1"

  # Attach and default to the nvim window
  exec tmux attach-session -t "$SESSION_NAME"
}
